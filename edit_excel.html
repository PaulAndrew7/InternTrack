<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Student Details</title>
    <style>
        /* Global Styles */
        * {
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
        }

        body {
    background: white;
    color: #333;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh; /* Change height to min-height */
    text-align: center;
    padding: 20px;
    overflow-y: auto; /* Enables vertical scrolling */
}


        .container {
            max-width: 500px;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0px 10px 25px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .container:hover {
            transform: scale(1.02);
        }

        h2 {
            color: #3498db;
            margin-bottom: 20px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
            transition: 0.3s;
        }

        input:focus, select:focus {
            border-color: #3498db;
            box-shadow: 0px 0px 8px rgba(52, 152, 219, 0.6);
            outline: none;
        }

        button {
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background: linear-gradient(135deg, #3498db, #217dbb);
            color: white;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        button:hover {
            background: linear-gradient(135deg, #217dbb, #3498db);
            transform: translateY(-3px);
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
        }

        .checkbox-group {
            text-align: left;
            margin-top: 10px;
        }

        .checkbox-group label {
            display: block;
            padding: 8px;
            font-size: 16px;
            border-radius: 5px;
            background: #e3f2fd;
            color: #217dbb;
            margin-bottom: 5px;
            transition: 0.3s;
        }

        .checkbox-group label:hover {
            background: #bbdefb;
        }

        input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.3);
            cursor: pointer;
        }

        p {
            font-size: 16px;
            color: green;
            font-weight: bold;
            margin-top: 15px;
        }

        /* Responsive Design */
        @media (max-width: 500px) {
            .container {
                width: 90%;
                padding: 20px;
            }

            button {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Edit Student Details</h2>
        <input type="text" id="regno" placeholder="Enter Register No">
        <button onclick="fetchDetails()">Fetch Details</button>

        <form id="studentForm" style="display: none;">
            <input type="text" id="name" placeholder="Name">
            <input type="text" id="mobile" placeholder="Mobile No">
            <input type="text" id="section" placeholder="Section">
            <select id="internship">
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
            <input type="text" id="period" placeholder="Internship Period">
            <input type="date" id="startdate">
            <input type="date" id="enddate">
            <input type="text" id="company" placeholder="Company Name">
            <select  id="src" aria-placeholder="Placement source">
                <option value="college">Through College</option>
                <option value="cdc">CDC</option>
                <option value="outside">Outside</option>
            </select>
            <input type="number" id="stipend" placeholder="Stipend">
            <select  id="type" aria-placeholder="Placement type">
                <option value="research">Research</option>
                <option value="industry">Industrial</option>
            </select>
           <select id="location" aria-placeholder="Location">
                <option value="india">India</option>
                <option value="abroad">Abroad</option>
           </select>
        
            <h3 style="color: #3498db;">Document Submission</h3>
            <div class="checkbox-group">
                <label><input type="checkbox" id="offer"> Signed Permission Letter, Offer Letter Submitted</label>
                <label><input type="checkbox" id="completion"> Completion Certificate Submitted</label>
                <label><input type="checkbox" id="report"> Internship Report Submitted</label>
                <label><input type="checkbox" id="feedback"> Student Feedback Submitted</label>
                <label><input type="checkbox" id="emp"> Employer Feedback Submitted</label>
            </div>

            <button type="button" onclick="updateDetails()">Update</button>
        </form>

        <p id="message"></p>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
    const regno = localStorage.getItem("regno");
    if (!regno) {
        alert("You must be logged in!");
        window.location.href = "login.html";
    } else {
        document.getElementById("regno").value = regno;
        document.getElementById("regno").readOnly = true; // Prevent editing regno
        fetchDetails();
    }
});

async function fetchDetails() {
    const regno = localStorage.getItem("regno");

    const response = await fetch(`http://localhost:3000/getStudent/${regno}`);
    const data = await response.json();

    if (data.success) {
        document.getElementById("studentForm").style.display = "block";
        document.getElementById("name").value = data.student.Name;
        document.getElementById("mobile").value = data.student["Mobile No"];
        document.getElementById("section").value = data.student.Section;
        document.getElementById("internship").value = data.student["Obtained Internship"];
        document.getElementById("period").value = data.student.Period;
        document.getElementById("startdate").value = data.student["Start Date"];
        document.getElementById("enddate").value = data.student["End Date"];
        document.getElementById("company").value = data.student["Company Name"];
        document.getElementById("src").value = data.student["Placement Source"];
        document.getElementById("stipend").value = data.student["Stipend (Rs.)"];
        document.getElementById("type").value = data.student["Internship Type"];
        document.getElementById("location").value = data.student.Location;

        // Pre-fill checkboxes
        document.getElementById("offer").checked = data.student["Offer Letter Submitted"] === "Yes";
        document.getElementById("completion").checked = data.student["Completion Certificate"] === "Yes";
        document.getElementById("report").checked = data.student["Internship Report Submitted"] === "Yes";
        document.getElementById("feedback").checked = data.student["Student Feedback Submitted"] === "Yes";
        document.getElementById("emp").checked = data.student["Employer Feedback Submitted"] === "Yes";
    } else {
        alert("Student not found!");
    }
}

async function updateDetails() {
    const regno = localStorage.getItem("regno"); // Always use logged-in regno

    // Validation
    const mobilePattern = /^[6-9]\d{9}$/; // Validates Indian mobile numbers
    const periodPattern = /^[0-9]+ (days|weeks|months|years)$/i; // Validates "X days/weeks/months/years"
    
    const name = document.getElementById("name").value.trim();
    const mobile = document.getElementById("mobile").value.trim();
    const section = document.getElementById("section").value.trim();
    const internship = document.getElementById("internship").value;
    const period = document.getElementById("period").value.trim();
    const startdate = document.getElementById("startdate").value;
    const enddate = document.getElementById("enddate").value;
    const company = document.getElementById("company").value.trim();
    const src = document.getElementById("src").value;
    const stipend = document.getElementById("stipend").value.trim();
    const type = document.getElementById("type").value;
    const location = document.getElementById("location").value;

    // Validation Checks
    if (!name) {
        alert("Name cannot be empty.");
        return;
    }

    if (!mobilePattern.test(mobile)) {
        alert("Enter a valid 10-digit mobile number.");
        return;
    }

    if (!section) {
        alert("Section cannot be empty.");
        return;
    }

    if (internship === "yes" && !periodPattern.test(period)) {
        alert("Internship period must be in the format: 'X days/weeks/months/years'");
        return;
    }

    if (internship === "yes" && (!startdate || !enddate)) {
        alert("Start Date and End Date are required for internships.");
        return;
    }

    if (new Date(startdate) > new Date(enddate)) {
        alert("Start Date cannot be after End Date.");
        return;
    }

    if (internship === "yes" && !company) {
        alert("Company Name is required for internships.");
        return;
    }

    if (internship === "yes" && stipend && isNaN(stipend)) {
        alert("Stipend must be a valid number.");
        return;
    }

    // Data to Send
    const updatedData = {
        regno,
        name,
        mobile,
        section,
        internship,
        period,
        startdate,
        enddate,
        company,
        src,
        stipend,
        type,
        location,

        // Ensure checkboxes always send data
        offer: document.getElementById("offer").checked.toString(),
        completion: document.getElementById("completion").checked.toString(),
        report: document.getElementById("report").checked.toString(),
        feedback: document.getElementById("feedback").checked.toString(),
        emp: document.getElementById("emp").checked.toString()
    };

    // Send Data
    const response = await fetch("http://localhost:3000/updateStudent", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updatedData)
    });

    const result = await response.json();
    document.getElementById("message").textContent = result.message;
}

    </script>

</body>
</html>
